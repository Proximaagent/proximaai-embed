(function(){const script=document.currentScript;const iframeSrc=script.dataset.iframeSrc||"https://interactive.proximaai.co/home";const widgetStyle=script.dataset.widgetStyle?JSON.parse(script.dataset.widgetStyle):{};const iframeContainerStyle=script.dataset.iframeContainerStyle?JSON.parse(script.dataset.iframeContainerStyle):{};const closeButtonStyle=script.dataset.closeButtonStyle?JSON.parse(script.dataset.closeButtonStyle):{};const iconColor=script.dataset.iconColor||"#2daab1";const tenantName=script.dataset.tenantName||"Proxima AI";const appId=script.dataset.appId||"";const tenantId=script.dataset.tenantId||"";const defaultStyles=`\n#custom-widget {\nposition: fixed;\nbottom: 20px;\nright: 20px;\nwidth: 60px;\nheight: 60px;\ndisplay: flex;\njustify-content: center;\nalign-items: center;\nborder-radius: 50%;\ncursor: pointer;\nz-index: 9999;\nbackground: ${widgetStyle.background||"#000"};\n}\n\n#notification-container {\nposition: fixed;\nbottom: 20px;\nright: 90px;\nheight: 60px;\nbackground: white;\nborder-radius: 8px;\nbox-shadow: 0 2px 10px rgba(0,0,0,0.1);\ndisplay: flex;\nalign-items: center;\npadding: 0 15px;\ntransform: translateX(calc(100% + 90px));\nopacity: 0;\npointer-events: none;\ntransition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);\nz-index: 9998;\nborder: 1px solid ${iconColor};\n}\n\n#notification-container.show {\ntransform: translateX(0);\nopacity: 1;\npointer-events: auto;\n}\n\n#notification-content {\nmargin-right: 15px;\ncolor: #333;\nfont-size: 14px;\n}\n\n#notification-close {\ncursor: pointer;\ncolor: ${iconColor};\nfont-size: 20px;\npadding: 5px;\ndisplay: flex;\nalign-items: center;\njustify-content: center;\ntransition: transform 0.2s ease;\n}\n\n#notification-close:hover {\ntransform: scale(1.1);\n}\n\n#custom-iframe-container {\nposition: fixed;\nbottom: 20px;\nright: 20px;\nwidth: 500px;\nheight: 96vh;\ndisplay: none;\nflex-direction: column;\nz-index: 9999;\nborder: 1px solid ${iframeContainerStyle.borderColor||"#ccc"};\nbackground-color: ${iframeContainerStyle.backgroundColor||"#fff"};\n}\n#custom-iframe {\nflex-grow: 1;\nborder: none;\n}\n#close-btn {\nheight: 40px;\ncolor: ${closeButtonStyle.color||iconColor};\ncursor: pointer;\ntext-align: center;\nline-height: 40px;\ndisplay: flex;\njustify-content: space-between;\npadding: 0 10px;\n}\n@media (max-width: 768px) {\n#custom-iframe-container {\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n  border: none;\n}\n#notification-container {\n  right: 70px;\n  max-width: calc(100% - 100px);\n}\n}\n@media (min-width: 769px) {\n#custom-iframe-container {\n  border-radius: 20px;\n  overflow: hidden; \n}\n}\n`;const styleSheet=document.createElement("style");styleSheet.type="text/css";styleSheet.innerText=defaultStyles;document.head.appendChild(styleSheet);const NOTIFICATION_INTERVAL=3*24*60*60*1e3;const STORAGE_KEY="lastNotificationTime";function shouldShowNotification(){const lastShown=localStorage.getItem(STORAGE_KEY);if(!lastShown)return true;const timeSinceLastShown=Date.now()-parseInt(lastShown);return timeSinceLastShown>=NOTIFICATION_INTERVAL}function updateLastShownTime(){localStorage.setItem(STORAGE_KEY,Date.now().toString())}const notificationContainer=document.createElement("div");notificationContainer.id="notification-container";const notificationContent=document.createElement("div");notificationContent.id="notification-content";notificationContent.textContent=`Hello I'm ${tenantName} assistant!`;const notificationClose=document.createElement("div");notificationClose.id="notification-close";notificationClose.innerHTML="&times;";notificationContainer.appendChild(notificationContent);notificationContainer.appendChild(notificationClose);const widget=document.createElement("div");widget.id="custom-widget";const svg=`\n<svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 368.697 400">\n<defs>\n  <linearGradient id="a" x1="330.454" y1="326.319" x2="77.231" y2="58.335" gradientUnits="userSpaceOnUse">\n    <stop offset=".604" stop-color="#2cabb1"/>\n    <stop offset="1" stop-color="#00e0c1"/>\n  </linearGradient>\n</defs>\n<circle cx="117.252" cy="148.157" r="31.597" fill="white"/>\n<circle cx="241.067" cy="148.157" r="31.597" fill="white"/>\n<path d="M64.328 223.757q.938 18.606 1.873 37.214c8.95 8.51 51.4 47.042 117.489 47.278 68.522.244 112.188-40.857 120.572-49.071v-36.124c-12.127 9.809-55.472 42.417-119.863 42.6-64.362.18-107.883-32.154-120.071-41.897" fill="white"/>\n<path d="M383.921 298.622V77.036A77.263 77.263 0 0 0 306.885 0H92.3a77.26 77.26 0 0 0-77.037 77.036v221.586a76.8 76.8 0 0 0 22.63 54.407c19.165 19.165 44.442 22.527 54.406 22.629h.057a2706 2706 0 0 0 50.458 0L136.962 400l95.027-24.342h74.9a83.7 83.7 0 0 0 43.834-12.184 73.3 73.3 0 0 0 16.786-14.03c16.116-18.771 16.669-42.059 16.412-50.822M256.33 116.559a31.6 31.6 0 1 1-31.6 31.6 31.6 31.6 0 0 1 31.6-31.6m-123.815 0a31.6 31.6 0 1 1-31.6 31.6 31.6 31.6 0 0 1 31.6-31.6m187.01 142.619c-8.384 8.214-52.05 49.315-120.572 49.071-66.089-.236-108.539-38.768-117.489-47.278l-1.873-37.214c12.188 9.74 55.705 42.077 120.071 41.895 64.391-.181 107.736-32.789 119.863-42.6Z" transform="translate(-15.263)" fill="${iconColor}"/>\n</svg>\n`;widget.innerHTML=svg;Object.assign(widget.style,widgetStyle);const iframeContainer=document.createElement("div");iframeContainer.id="custom-iframe-container";Object.assign(iframeContainer.style,iframeContainerStyle);const closeButton=document.createElement("div");closeButton.id="close-btn";const dateSpan=document.createElement("span");dateSpan.innerText=(new Date).toLocaleDateString();const closeIcon=document.createElement("span");closeIcon.innerHTML="&times;";closeButton.appendChild(dateSpan);closeButton.appendChild(closeIcon);Object.assign(closeButton.style,closeButtonStyle);const iframe=document.createElement("iframe");iframe.id="custom-iframe";iframe.src=iframeSrc;iframeContainer.appendChild(closeButton);iframeContainer.appendChild(iframe);function showNotification(){if(shouldShowNotification()){notificationContainer.classList.add("show");updateLastShownTime()}}function hideNotification(){notificationContainer.classList.remove("show")}widget.onclick=()=>{widget.style.display="none";iframeContainer.style.display="flex";hideNotification()};closeButton.onclick=()=>{iframeContainer.style.display="none";widget.style.display="flex"};notificationClose.onclick=e=>{e.stopPropagation();hideNotification()};notificationContainer.onclick=()=>{widget.click()};showNotification();function cleanupIframeElements(){const existingWidget=document.getElementById("custom-widget");const existingContainer=document.getElementById("custom-iframe-container");const existingNotification=document.getElementById("notification-container");if(existingWidget)existingWidget.remove();if(existingContainer)existingContainer.remove();if(existingNotification)existingNotification.remove()}async function mountIframeIfSubscribed(){const isSubscribed=await checkTenantPlatformSubscription(iframeSrc,appId);if(isSubscribed){document.body.appendChild(widget);document.body.appendChild(iframeContainer);document.body.appendChild(notificationContainer)}else{console.log("User does not have an active subscription.");cleanupIframeElements()}}mountIframeIfSubscribed();async function checkTenantPlatformSubscription(iframeSrc,appId){try{const url=new URL(iframeSrc);const authToken=url.searchParams.get("auth_uri");const apiUrl=new URL("https://core.proximaai.co/api/tenantmanagement/tenantdetails/");apiUrl.searchParams.append("token",authToken||"");apiUrl.searchParams.append("platform",appId);apiUrl.searchParams.append("tenant_id",tenantId);const response=await fetch(apiUrl,{method:"GET",headers:{"Content-Type":"application/json"}});if(!response.ok)return false;const data=await response.json();console.log("Subscription data:",data);if(!Array.isArray(data.subscription_platforms)){console.error("Invalid subscription data format");return false}const platformSubscription=data.subscription_platforms.find((platform=>platform.platform_name===appId));if(!platformSubscription){console.log(`No subscription found for platform: ${appId}`);return false}return platformSubscription.is_active===true}catch(error){console.error("Error checking subscription:",error);return false}}})();