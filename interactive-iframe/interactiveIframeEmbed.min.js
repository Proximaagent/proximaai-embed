(function(){const script=document.currentScript;const iframeSrc=script.dataset.iframeSrc||"https://interactive.proximaai.co/home";const widgetStyle=script.dataset.widgetStyle?JSON.parse(script.dataset.widgetStyle):{};const iframeContainerStyle=script.dataset.iframeContainerStyle?JSON.parse(script.dataset.iframeContainerStyle):{};const closeButtonStyle=script.dataset.closeButtonStyle?JSON.parse(script.dataset.closeButtonStyle):{};const iconColor=script.dataset.iconColor||"#2daab1";const tenantName=script.dataset.tenantName||"Proxima AI";const appId=script.dataset.appId;const tenantId=script.dataset.tenantId;async function init(){const hasSubscription=await checkTenantPlatformSubscription(tenantId,appId);if(!hasSubscription){console.log("Please subscribe to Proxima AI to use this feature.");return}const defaultStyles=`\n  #custom-widget {\n  position: fixed;\n  bottom: 20px;\n  right: 20px;\n  width: 60px;\n  height: 60px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border-radius: 50%;\n  cursor: pointer;\n  z-index: 9999;\n  background: ${widgetStyle.background||"#000"};\n  }\n  \n  #notification-container {\n  position: fixed;\n  bottom: 20px;\n  right: 90px;\n  height: 60px;\n  background: white;\n  border-radius: 8px;\n  box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n  display: flex;\n  align-items: center;\n  padding: 0 15px;\n  transform: translateX(calc(100% + 90px));\n  opacity: 0;\n  pointer-events: none;\n  transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);\n  z-index: 9998;\n  border: 1px solid ${iconColor};\n  }\n  \n  #notification-container.show {\n  transform: translateX(0);\n  opacity: 1;\n  pointer-events: auto;\n  }\n  \n  #notification-content {\n  margin-right: 15px;\n  color: #333;\n  font-size: 14px;\n  }\n  \n  #notification-close {\n  cursor: pointer;\n  color: ${iconColor};\n  font-size: 20px;\n  padding: 5px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: transform 0.2s ease;\n  }\n  \n  #notification-close:hover {\n  transform: scale(1.1);\n  }\n  \n  #custom-iframe-container {\n  position: fixed;\n  bottom: 20px;\n  right: 20px;\n  width: 500px;\n  height: 96vh;\n  display: none;\n  flex-direction: column;\n  z-index: 9999;\n  border: 1px solid ${iframeContainerStyle.borderColor||"#ccc"};\n  background-color: ${iframeContainerStyle.backgroundColor||"#fff"};\n  }\n  #custom-iframe {\n  flex-grow: 1;\n  border: none;\n  }\n  #close-btn {\n  height: 40px;\n  color: ${closeButtonStyle.color||iconColor};\n  cursor: pointer;\n  text-align: center;\n  line-height: 40px;\n  display: flex;\n  justify-content: space-between;\n  padding: 0 10px;\n  }\n  @media (max-width: 768px) {\n  #custom-iframe-container {\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    width: 100%;\n    height: 100%;\n    border: none;\n  }\n  #notification-container {\n    right: 70px;\n    max-width: calc(100% - 100px);\n  }\n  }\n  @media (min-width: 769px) {\n  #custom-iframe-container {\n    border-radius: 20px;\n    overflow: hidden; \n  }\n  }\n  `;const styleSheet=document.createElement("style");styleSheet.type="text/css";styleSheet.innerText=defaultStyles;document.head.appendChild(styleSheet);const NOTIFICATION_INTERVAL=3*24*60*60*1e3;const STORAGE_KEY="lastNotificationTime";function shouldShowNotification(){const lastShown=localStorage.getItem(STORAGE_KEY);if(!lastShown)return true;const timeSinceLastShown=Date.now()-parseInt(lastShown);return timeSinceLastShown>=NOTIFICATION_INTERVAL}function updateLastShownTime(){localStorage.setItem(STORAGE_KEY,Date.now().toString())}const notificationContainer=document.createElement("div");notificationContainer.id="notification-container";const notificationContent=document.createElement("div");notificationContent.id="notification-content";notificationContent.textContent=`Hello I'm ${tenantName} assistant!`;const notificationClose=document.createElement("div");notificationClose.id="notification-close";notificationClose.innerHTML="&times;";notificationContainer.appendChild(notificationContent);notificationContainer.appendChild(notificationClose);const widget=document.createElement("div");widget.id="custom-widget";const svg=`\n  <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 368.697 400">\n  <defs>\n    <linearGradient id="a" x1="330.454" y1="326.319" x2="77.231" y2="58.335" gradientUnits="userSpaceOnUse">\n      <stop offset=".604" stop-color="#2cabb1"/>\n      <stop offset="1" stop-color="#00e0c1"/>\n    </linearGradient>\n  </defs>\n  <circle cx="117.252" cy="148.157" r="31.597" fill="white"/>\n  <circle cx="241.067" cy="148.157" r="31.597" fill="white"/>\n  <path d="M64.328 223.757q.938 18.606 1.873 37.214c8.95 8.51 51.4 47.042 117.489 47.278 68.522.244 112.188-40.857 120.572-49.071v-36.124c-12.127 9.809-55.472 42.417-119.863 42.6-64.362.18-107.883-32.154-120.071-41.897" fill="white"/>\n  <path d="M383.921 298.622V77.036A77.263 77.263 0 0 0 306.885 0H92.3a77.26 77.26 0 0 0-77.037 77.036v221.586a76.8 76.8 0 0 0 22.63 54.407c19.165 19.165 44.442 22.527 54.406 22.629h.057a2706 2706 0 0 0 50.458 0L136.962 400l95.027-24.342h74.9a83.7 83.7 0 0 0 43.834-12.184 73.3 73.3 0 0 0 16.786-14.03c16.116-18.771 16.669-42.059 16.412-50.822M256.33 116.559a31.6 31.6 0 1 1-31.6 31.6 31.6 31.6 0 0 1 31.6-31.6m-123.815 0a31.6 31.6 0 1 1-31.6 31.6 31.6 31.6 0 0 1 31.6-31.6m187.01 142.619c-8.384 8.214-52.05 49.315-120.572 49.071-66.089-.236-108.539-38.768-117.489-47.278l-1.873-37.214c12.188 9.74 55.705 42.077 120.071 41.895 64.391-.181 107.736-32.789 119.863-42.6Z" transform="translate(-15.263)" fill="${iconColor}"/>\n  </svg>\n  `;widget.innerHTML=svg;Object.assign(widget.style,widgetStyle);const iframeContainer=document.createElement("div");iframeContainer.id="custom-iframe-container";Object.assign(iframeContainer.style,iframeContainerStyle);const closeButton=document.createElement("div");closeButton.id="close-btn";const dateSpan=document.createElement("span");dateSpan.innerText=(new Date).toLocaleDateString();const closeIcon=document.createElement("span");closeIcon.innerHTML="&times;";closeButton.appendChild(dateSpan);closeButton.appendChild(closeIcon);Object.assign(closeButton.style,closeButtonStyle);const iframe=document.createElement("iframe");iframe.id="custom-iframe";iframe.src=iframeSrc;iframeContainer.appendChild(closeButton);iframeContainer.appendChild(iframe);document.body.appendChild(widget);document.body.appendChild(iframeContainer);document.body.appendChild(notificationContainer);function showNotification(){if(shouldShowNotification()){notificationContainer.classList.add("show");updateLastShownTime()}}function hideNotification(){notificationContainer.classList.remove("show")}widget.onclick=()=>{widget.style.display="none";iframeContainer.style.display="flex";hideNotification()};closeButton.onclick=()=>{iframeContainer.style.display="none";widget.style.display="flex"};notificationClose.onclick=e=>{e.stopPropagation();hideNotification()};notificationContainer.onclick=()=>{widget.click()};showNotification()}async function checkTenantPlatformSubscription(tenantId,appId){console.log(tenantId,appId);if(!tenantId||!appId){return false}try{const response=await fetch(`https://core.proximaai.co/api/tenantmanagement/tenantdetails/?token=${tenantId}&platform=${appId}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!response.ok){return false}const data=await response.json();if(!data.has_active_subscription){return false}const platformSubscription=data.subscription_platforms.find((platform=>platform.platform_name===appId));return platformSubscription?platformSubscription.is_active:false}catch(error){console.error("Error checking tenant subscription:",error);return false}}init()})();